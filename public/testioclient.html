<!DOCTYPE html>
<html>
  <head>
    <script
      src="https://cdn.socket.io/4.0.0/socket.io.min.js"
      integrity="sha384-DkkWv9oJFWLIydBXXjkBWnG1/fuVhw8YPBq37uvvD6WSYRFRqr21eY5Dg9ZhmWdy"
      crossorigin="anonymous"
    ></script>

    <script>
      let gameId;
      window.onload = function() {
        const socket = io(`http://localhost:3010?type=devices`, {
          path: '/game-controller-socket.io',
          reconnectionDelayMax: 10000,
          withCredentials: true,
          extraHeaders: {
            'levelup-token-header':
              'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c',
          },
        });
        socket.on('connect', function() {});

        socket.on('__reporting_bff_::_game_event::_started', function(message) {
          console.log(message);
          gameId = message.id;
          newButton.style.display = 'none';
          hitButton.style.display = 'block';
          endButton.style.display = 'block';
        });

        socket.on('__reporting_bff_::_game_event::_target-hit', function(
          message
        ) {
          console.log(message);
        });

        socket.on('__reporting_bff_::_game_event::_finished', function(
          message
        ) {
          gameId = '';
          newButton.style.display = 'block';
          hitButton.style.display = 'none';
          endButton.style.display = 'none';
        });

        var newButton = document.getElementById('new');
        var hitButton = document.getElementById('hit');
        var endButton = document.getElementById('end');

        hitButton.style.display = 'none';
        endButton.style.display = 'none';

        var form = document.getElementById('form');

        newButton.addEventListener('click', function(e) {
          e.preventDefault();
          socket.emit('__device_::_game_event::_new-game');
        });

        hitButton.addEventListener('click', function(e) {
          e.preventDefault();
          socket.emit('__device_::_game_event::_target-hit', {
            gameId: gameId,
          });
        });

        endButton.addEventListener('click', function(e) {
          e.preventDefault();
          socket.emit('__device_::_game_event::_end-game', { gameId: gameId });
        });

        form.addEventListener('submit', function(e) {
          e.preventDefault();
          var data = { count: 4 };

          socket.emit('hit', data);
        });
      };
    </script>
  </head>
  <body>
    <form id="form" action="">
      <button id="new">New Game</button>
      <button id="hit">Hit</button>
      <button id="end">End Game</button>
    </form>
  </body>
</html>
